<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>4&nbsp; Lecture 4 – Muliple Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="../site_libs/kePrint-0.0.1/kePrint.js"></script><link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#non-linear-regression" id="toc-non-linear-regression" class="nav-link active" data-scroll-target="#non-linear-regression"><span class="header-section-number">4.1</span> Non-Linear Regression</a>
  <ul class="collapse">
<li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="header-section-number">4.1.1</span> Logistic regression</a></li>
  <li><a href="#poisson-regression" id="toc-poisson-regression" class="nav-link" data-scroll-target="#poisson-regression"><span class="header-section-number">4.1.2</span> Poisson regression</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Lecture 4</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p><strong>Required packages</strong></p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>  <span class="co"># tidy and wrangle data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>      <span class="co"># create tidy tables for statistical objects</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/effectsize/">effectsize</a></span><span class="op">)</span> <span class="co"># calculate effect size</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span> <span class="co"># create tidy tables</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/debruine/faux">faux</a></span><span class="op">)</span>       <span class="co"># simulate factorial data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span>     <span class="co"># create tables</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/atahk/pscl">pscl</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="non-linear-regression" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="non-linear-regression">
<span class="header-section-number">4.1</span> Non-Linear Regression</h2>
<p>Linear regression does not work for:</p>
<ul>
<li><p>binary outcomes: For example, predicting a disease (yes/no) based on the age, sex, smoking and blood pressure. Alternative: logistic regression</p></li>
<li><p>discrete outcomes: For example, classify severity as low, medium or high. Alternative: ordinal logistic regression.</p></li>
<li><p>count outcomes: For example, number of hospital visits, number of cigarettes smoked per day. Alternative: poisson regression or negative binomial regression</p></li>
</ul>
<p>Generalized linear models, which extend the linear regression model to work with binary, discrete and count outcomes and other data that cannot be fit well with normally distributed errors.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hist1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">4000</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Normal distirbution"</span>, xlab <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">hist2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fl">4000</span>, <span class="fl">1</span>, <span class="fl">0.05</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Binomial distirbution"</span>, xlab <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">hist3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="fl">4000</span>, <span class="fl">1</span>, <span class="fl">100</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Gamma distirbution"</span>, xlab <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">hist4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">4000</span>, <span class="fl">0.5</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Poisson distirbution"</span>, xlab <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="lecture_4_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Types of distirbutions</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Distribution</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Normal</td>
<td style="text-align: left; width: 14cm;">Standard linear regression is useful when data follows a bell-shaped distribution.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Binomial</td>
<td style="text-align: left; width: 14cm;">Binary logisitic regression.Useful when the response is binary (e.g., yes/no).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gamma</td>
<td style="text-align: left; width: 14cm;">Gamma regression is useful when data is highly positively skewed.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Poisson</td>
<td style="text-align: left; width: 14cm;">Poisson regression is useful for count data.</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="logistic-regression" class="level3" data-number="4.1.1"><h3 data-number="4.1.1" class="anchored" data-anchor-id="logistic-regression">
<span class="header-section-number">4.1.1</span> Logistic regression</h3>
<p>In linear regression, the outcome is a continuous variable, meaning that it can take on a range of numerical values. In contrast, logistic regression is used when the outcome is binary-that is, a categorical variable with exactly two possible values, such as “yes” or “nor”, “success” or “failure”, or “disease” or “no disease”. To model binary data, we need to add two features to the base model <code>y</code> = <code>b0</code>+ <code>b1x1</code>:</p>
<ul>
<li><p>a nonlinear transformation that bounds the output between 0 and 1 (unlike <code>y</code> = <code>b0</code>+ <code>b1x1</code>, which is continuous), and</p></li>
<li><p>a model that treats the resulting numbers as probabilities and maps them into random binary outcomes.</p></li>
</ul>
<p>Logistic regression models the probability of one of these outcomes occurring as a function of one or more predictor variables. For example, logistic regression can be used to model the relationship between between heart coronary disease (yes or no) and predictors such as age and blood pressure. Similarly, it can be used to model the probability of a student dropping out of school (yes or no) based socioeconomic factors.</p>
<p>The model of a logistic regression</p>
<p>In logistic regression, the model estimates the log-odds of the binary outcome <code>y</code> as a linear function of predictors:</p>
<p><span class="math display">\[
log(\frac{P(Y = 1)}{P(Y = 0)}) = b_0 + b_{1}x_{1} + b_{2}x_{2} + ... + b_{p}x_{p}
\]</span></p>
<ul>
<li><p><code>b0</code>: the intercept is log-odds of the outcome when all predictors are equal to zero. Exponentiating <code>b0</code> gives the odds of the outcome when all predictors are equal to 0.</p></li>
<li><p>If <code>x</code> is a continuous predictor the regression coefficient <code>b</code> represents the change in the log-odds of the outcome per one-unit increase in <code>x</code>, holding all other predictors constant. Equivalently, <code>exp(b)</code> is the odds ratio (OR) for a one-unit increase in <code>x</code>.</p></li>
<li><p>If <code>x</code> is a categorical predictor (with k levels) is represented using dummy variables, comparing each level to a reference category. The coefficient <code>b</code> for a given level represents the difference in log-odds of the outcome between that category and the reference category, again holding other variables constant. Equivalently, <code>exp(b)</code> is the odds ratio comparing that level to the reference level.</p></li>
</ul>
<section id="why-not-to-use-a-linear-regression-when-outcome-is-binary" class="level4" data-number="4.1.1.1"><h4 data-number="4.1.1.1" class="anchored" data-anchor-id="why-not-to-use-a-linear-regression-when-outcome-is-binary">
<span class="header-section-number">4.1.1.1</span> Why not to use a linear regression when outcome is binary</h4>
<p>First let’s simulate data where <code>disease</code> is a binary outcome and <code>cholesterol</code> is a continuous predictor.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">050990</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a binomial variable</span></span>
<span><span class="va">disease</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a continuous predictor</span></span>
<span><span class="va">cholesterol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">disease</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">220</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">190</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a data set</span></span>
<span><span class="va">disease_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>disease <span class="op">=</span> <span class="va">disease</span>, cholesterol <span class="op">=</span> <span class="va">cholesterol</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">disease_df</span>, <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  disease cholesterol
1       1    207.6714
2       1    254.9519
3       1    235.0051
4       1    193.6956
5       0    193.1898</code></pre>
</div>
</div>
<p>Now let’s illustrate the relationship between <code>disease</code> and <code>cholesterol</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">disease_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">disease</span>, x <span class="op">=</span> <span class="va">cholesterol</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">140</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">lm</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="lecture_4_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The straight line fitted using a linear model poorly fits the data. However, the red S-shaped curve better reflects the probability structure of binary data.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">disease_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">disease</span>, x <span class="op">=</span> <span class="va">cholesterol</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">140</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">glm</span>, method.args<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="lecture_4_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Another key problem when using a linear regression model for binary outcomes is that the estimated values (interpreted as probabilities) can fall outside the range 0-1.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">linear_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">disease</span> <span class="op">~</span> <span class="va">cholesterol</span>, <span class="va">disease_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">linear_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)  -4.10    0.136        -30.0 6.28e-114
2 cholesterol   0.0225  0.000667      33.8 4.79e-131</code></pre>
</div>
</div>
<p>For example, when <code>cholesterol</code> is 0, the linear model estimates that the probability of disease is -4.1 - which is not a valid probability. In contrast, logistic regression constrains the estimated values within the range [0, 1] making it appropriate for classification tasks. In R we can fit a logistic linear regression using glm(family = binomial).</p>
<div>
<p><strong>Note</strong></p>
<p>Contrast with Linear Regression:</p>
<ul>
<li><p>Linear regression minimizes the vertical distance (squared errors) between observed data points and the fitted line.</p></li>
<li><p>Logistic regression maximizes the likelihood - the joint probability of the observed outcome given the model’s predicted probabilities (i.e., the parameter estimates are those values which maximize the likelihood of the data which have been observed).</p></li>
</ul>
</div>
</section><section id="interpreting-logistic-regression-coefficients" class="level4" data-number="4.1.1.2"><h4 data-number="4.1.1.2" class="anchored" data-anchor-id="interpreting-logistic-regression-coefficients">
<span class="header-section-number">4.1.1.2</span> Interpreting logistic regression coefficients</h4>
<p>To interpret the logistic regression output, we need to transform the coefficients from the log-odds scale to OR and probabilities.</p>
<p>1- Fit a logistic simple model:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit a logistic simple model</span></span>
<span><span class="va">logistic_model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">disease</span> <span class="op">~</span> <span class="va">cholesterol</span>, family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">disease_df</span><span class="op">)</span></span>
<span><span class="va">logistic_model1</span><span class="op">$</span><span class="va">coefficients</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) cholesterol 
-60.2681245   0.2956278 </code></pre>
</div>
</div>
<p>As it appears now, <code>(Intercept)</code> and <code>cholesterol</code> represent the log-odds of disease.</p>
<p>2- Convert coefficients to Odds Ratios using <code><a href="https://rdrr.io/r/base/Log.html">exp()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">or_b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logistic_model1</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">or_b1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.34397</code></pre>
</div>
</div>
<p>Each 1-unit increase in cholesterol is associated with 1.34x higher odds of having the disease.</p>
<p>3- Estimate the probability of <code>disease</code> for a given cholesterol level</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">intercept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logistic_model1</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logistic_model1</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Cholesterol value</span></span>
<span><span class="va">cholesterol</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span></span>
<span><span class="co"># Compute log-odds</span></span>
<span><span class="va">log_odds</span> <span class="op">&lt;-</span> <span class="va">intercept</span> <span class="op">+</span> <span class="va">slope</span><span class="op">*</span><span class="va">cholesterol</span></span>
<span></span>
<span><span class="co">#Convert to probability of disease</span></span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">log_odds</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prob</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2418507</code></pre>
</div>
</div>
<p>Alternatively, we can use <code>predict(type = response)</code> to calculate the probability of <code>disease</code>`</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a data frame with new values</span></span>
<span><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>cholesterol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">250</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use predict(type = "response") to estimate probabilities for any given value </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logistic_model1</span>, <span class="va">new_data</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2 
0.2418507 0.9999988 </code></pre>
</div>
</div>
</section><section id="about-odds-and-odds-ratios" class="level4" data-number="4.1.1.3"><h4 data-number="4.1.1.3" class="anchored" data-anchor-id="about-odds-and-odds-ratios">
<span class="header-section-number">4.1.1.3</span> About odds and odds ratios</h4>
<section id="odds" class="level5" data-number="4.1.1.3.1"><h5 data-number="4.1.1.3.1" class="anchored" data-anchor-id="odds">
<span class="header-section-number">4.1.1.3.1</span> Odds</h5>
<p>The odds of an event are the ratio of how likely the event is to occur and how likely it is to not occur. Odds express likelihood relative to non-occurrence. Odds are calculated as:</p>
<p><span class="math display">\[
\frac {p}{(1-p)}
\]</span>where <em>p</em> is the probability of an event happening, and 1-<em>p</em> is the probability that the event does not happen. For example, if an event has a probability of 0.8, then the odds are:</p>
<p><span class="math display">\[
\frac {0.8}{(1-0.8)} = \frac {0.8}{0.2} = 4
\]</span></p>
<p>which is read as “4 to 1”.</p>
<p>When the probability is greater than 50% (0.5), the odds are always greater than 1. When the probability of an event are is smaller than 50%, the odds are smaller than 1. When the probability is 50%, the odds equal 1.</p>
</section><section id="odds-ratios" class="level5" data-number="4.1.1.3.2"><h5 data-number="4.1.1.3.2" class="anchored" data-anchor-id="odds-ratios">
<span class="header-section-number">4.1.1.3.2</span> Odds ratios</h5>
<p>An odds ratio (OR) compares the odds of an event occurring in one group to the odds of the same event occuring in another group. It quantifies how much more (or less) likely the event is in one group compared to the other. For example, suppose the probability of disease is 0.25 for patients with high cholesterol and 0.15 for patients with adequate levels. The OR is, therefore, calculated as:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">or</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">0.25</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">0.15</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">or</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.888889</code></pre>
</div>
</div>
<p>An OR of 1.89 implies that the first group has 89% greater odds of developing the disease than the second group.</p>
</section><section id="an-example-using-a-frequency-table" class="level5" data-number="4.1.1.3.3"><h5 data-number="4.1.1.3.3" class="anchored" data-anchor-id="an-example-using-a-frequency-table">
<span class="header-section-number">4.1.1.3.3</span> An example using a frequency table</h5>
<table class="caption-top table">
<thead><tr class="header">
<th>Exposure Status</th>
<th>Disease = Yes</th>
<th>Disease = No</th>
<th>Total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Smoker</strong></td>
<td>30</td>
<td>70</td>
<td>100</td>
</tr>
<tr class="even">
<td><strong>Non-smoker</strong></td>
<td>10</td>
<td>90</td>
<td>100</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>Odds of disease among exposed:</p>
<p><span class="math display">\[
\frac {30}{70} = 0.43
\]</span></p>
</li>
<li>
<p>Odds of disease among unexposed:</p>
<p><span class="math display">\[
\frac {10}{90} = 0.11
\]</span></p>
</li>
<li>
<p>Odds Ratio:</p>
<p><span class="math display">\[
\frac {0.43} {0.11} = 3.86
\]</span></p>
</li>
</ul>
<p>Interpretation:</p>
<ul>
<li><p>The odds of disease in the exposed group are 0.43</p></li>
<li><p>The odds of disease in the unexposed group are 0.11</p></li>
<li><p>The odd ratio is 3.86, meaning the exposed group has 3.86 times higher odds of developing the disease compared to the unexposed group.</p></li>
</ul></section></section><section id="multiple-logistic-regression" class="level4" data-number="4.1.1.4"><h4 data-number="4.1.1.4" class="anchored" data-anchor-id="multiple-logistic-regression">
<span class="header-section-number">4.1.1.4</span> Multiple logistic regression</h4>
<p>Just like in the linear regression, we can fit more than one predictor.</p>
<section id="model-with-one-continuous-predictor-and-one-categorical-predictor" class="level5" data-number="4.1.1.4.1"><h5 data-number="4.1.1.4.1" class="anchored" data-anchor-id="model-with-one-continuous-predictor-and-one-categorical-predictor">
<span class="header-section-number">4.1.1.4.1</span> Model with one continuous predictor and one categorical predictor</h5>
<p>Let’s create a second predictor of disease (i.e., smoking):</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">050990</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a binary predictor (smoking)</span></span>
<span><span class="va">smoking</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">disease</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1</span>, <span class="fl">0.7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1</span>, <span class="fl">0.10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add the new variable to the disease_df data set</span></span>
<span><span class="va">disease_df</span><span class="op">$</span><span class="va">smoking</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">smoking</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">disease_df</span>, <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  disease cholesterol smoking
1       1    207.6714       0
2       1    254.9519       0
3       1    235.0051       1
4       1    193.6956       0
5       0    193.1898       1</code></pre>
</div>
</div>
<p>Let’s fit model with both <code>cholesterol</code> and <code>smoking</code> as predictors of disease.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">logistic_model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">disease</span> <span class="op">~</span> <span class="va">cholesterol</span> <span class="op">+</span> <span class="va">smoking</span>, family <span class="op">=</span> <span class="va">binomial</span>, <span class="va">disease_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">logistic_model2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -59.9      6.44       -9.30 1.44e-20
2 cholesterol    0.292    0.0315      9.27 1.87e-20
3 smoking1       1.86     0.551       3.37 7.55e- 4</code></pre>
</div>
</div>
<p>Rather than using the <code><a href="https://rdrr.io/r/base/Log.html">exp()</a></code> function to convert log-odds coefficient of each single predictor to an OR like this:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logistic_model2</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.33875</code></pre>
</div>
</div>
<p>We can use <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> in the <code>broom</code> package with the argument <code>exponentitate = TRUE</code> to obtain the ORs for all predictors at once</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">logistic_model2</span>, exponentiate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">res</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept) 9.93e-27    6.44       -9.30 1.44e-20
2 cholesterol 1.34e+ 0    0.0315      9.27 1.87e-20
3 smoking1    6.41e+ 0    0.551       3.37 7.55e- 4</code></pre>
</div>
</div>
<p>We can interpret these coefficients as follows:</p>
<ul>
<li><p><code>cholesterol</code>: For each 1-unit increase, the odds of disease increase by 34%. This increase is statistically significant.</p></li>
<li><p><code>smoking1</code>: being a smoker (<code>smoking1 = 1</code>) increases the odds of disease by 541 % compared to a non-smoker. This increase is statistically significant.</p></li>
</ul>
<p>We can also obtain the confidence intervals (CIs) for the odds ratios by exponentiating the confidence intervals of the model coefficients:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># subset rows 2 and 3 since these correspond to the predictors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">logistic_model2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>               2.5 %    97.5 %
cholesterol 1.266617  1.434272
smoking1    2.274929 20.022067</code></pre>
</div>
</div>
<p>Alternatively, we can use <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> in the <strong><code>broom</code></strong> package with the argument <code>conf.int = TRUE</code> (along with <code>exponentiate = TRUE</code>) to get the odds ratios and their confidence intervals all at once:</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">logistic_model2</span>, </span>
<span>     exponentiate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  term        estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept) 9.93e-27    6.44       -9.30 1.44e-20 7.43e-33  8.29e-22
2 cholesterol 1.34e+ 0    0.0315      9.27 1.87e-20 1.27e+ 0  1.43e+ 0
3 smoking1    6.41e+ 0    0.551       3.37 7.55e- 4 2.27e+ 0  2.00e+ 1</code></pre>
</div>
</div>
<p>Now let’s simulate the probability of <code>disease</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Get the levels from the original data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">disease_df</span><span class="op">$</span><span class="va">smoking</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "0" "1"</code></pre>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create new values </span></span>
<span><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  cholesterol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">200</span>, <span class="fl">200</span><span class="op">)</span>,</span>
<span>  smoking <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">disease_df</span><span class="op">$</span><span class="va">smoking</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add predictions</span></span>
<span><span class="va">predicted_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logistic_model2</span>, <span class="va">new_data</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Store both numeric and pretty-formatted percentages</span></span>
<span><span class="va">new_data</span><span class="op">$</span><span class="va">probability</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">predicted_prob</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>  </span>
<span></span>
<span><span class="va">new_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cholesterol smoking probability
1          50       0        0.00
2          50       1        0.00
3         200       0       17.84
4         200       1       58.19</code></pre>
</div>
</div>
</section><section id="model-with-an-interaction-between-two-predictors" class="level5" data-number="4.1.1.4.2"><h5 data-number="4.1.1.4.2" class="anchored" data-anchor-id="model-with-an-interaction-between-two-predictors">
<span class="header-section-number">4.1.1.4.2</span> Model with an interaction between two predictors</h5>
<p>In this section, we analyze a dataset containing health records of patients to predict a binary outcome: whether a patient suffers from diabetes (<code>diabetes</code>: yes = 1 / no = 0).</p>
<p>The goal is to explore how various physiological indicators—such as body mass index, blood pressure, and glucose levels—are associated with the likelihood of <code>diabetes</code>.</p>
<p>Load and clean the data:</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/plotly/datasets/master/diabetes.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">outcome</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data</span>, <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pregnancies glucose bloodpressure skinthickness insulin  bmi
1           6     148            72            35       0 33.6
2           1      85            66            29       0 26.6
3           8     183            64             0       0 23.3
4           1      89            66            23      94 28.1
5           0     137            40            35     168 43.1
  diabetespedigreefunction age outcome
1                    0.627  50       1
2                    0.351  31       0
3                    0.672  32       1
4                    0.167  21       0
5                    2.288  33       1</code></pre>
</div>
</div>
<p>Fit a regression model with an interaction term between</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit a multiple regression logistic model</span></span>
<span><span class="va">logistic_model3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">glucose</span><span class="op">*</span><span class="va">bmi</span>, data <span class="op">=</span> <span class="va">data</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use tidy() to make it more readable</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">logistic_model3</span>, exponentiate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make estimates and p-values more interpretable</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">res</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>estimate_round <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">estimate</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>         p_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p.value</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">estimate_round</span>, <span class="va">std.error</span>, <span class="va">statistic</span>, <span class="va">p_value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  term        estimate_round std.error statistic p_value
  &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 (Intercept)           0     2.25        -4.50     0   
2 age                   1.03  0.00770      3.81     0   
3 glucose               1.05  0.0177       2.64     0.01
4 bmi                   1.14  0.0653       2.04     0.04
5 glucose:bmi           1     0.000508    -0.815    0.42</code></pre>
</div>
</div>
<p>Interpretation:</p>
<ul>
<li><p><code>age</code>: Every 1-year increase in age increases the odds of <code>diabetes</code> by 3%. This increase is statistically significant.</p></li>
<li><p><code>glucose</code>: Every 1-unit increase in glucose increases the odds of <code>diabetes</code> by 5%. This increase is statistically significant.</p></li>
<li><p><code>bmi</code>: Every 1-unit increase in body mass index increases the odds of <code>diabetes</code> by 14%. This increase is statistically significant.</p></li>
<li><p><code>glucos:bmi</code>: The effect of <code>glucose</code> on the odds of <code>diabetes</code> does not increase as <code>bmi</code> increases. The interaction effect is not statistically significant.</p></li>
</ul></section></section><section id="centering" class="level4" data-number="4.1.1.5"><h4 data-number="4.1.1.5" class="anchored" data-anchor-id="centering">
<span class="header-section-number">4.1.1.5</span> Centering</h4>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">glucose</span> <span class="op">+</span> <span class="va">bloodpressure</span>, data <span class="op">=</span> <span class="va">data</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>exponentiate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term          estimate std.error statistic  p.value
  &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)    0.00518   0.486     -10.8   2.57e-27
2 glucose        1.04      0.00329    11.6   7.22e-31
3 bloodpressure  0.998     0.00443    -0.354 7.23e- 1</code></pre>
</div>
</div>
<p><code>(intercept)</code> represents the odds of <code>diabetes</code> when all other variables are 0. However, interpreting <code>(intercept)</code> when <code>glucose = 0</code> and <code>bloodpressure = 0</code> is not meaningful as it is physiologically impossible. We can make <code>(intercept)</code> more interpretable by centering the predictors.</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Center the predictors</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">glucose_centered</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">glucose</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">glucose</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">bloodpressure_centered</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">bloodpressure</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">bloodpressure</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Refit the logistic regression model with the centered predictors</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">glucose_centered</span> <span class="op">+</span> <span class="va">bloodpressure_centered</span>, </span>
<span>           data <span class="op">=</span> <span class="va">data</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>exponentiate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term                   estimate std.error statistic  p.value
  &lt;chr&gt;                     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)               0.462   0.0883     -8.74  2.40e-18
2 glucose_centered          1.04    0.00329    11.6   7.22e-31
3 bloodpressure_centered    0.998   0.00443    -0.354 7.23e- 1</code></pre>
</div>
</div>
<p>Interpretation:</p>
<ul>
<li><p><code>(intercept)</code>: When <code>glucose</code> and <code>bloodpressure</code> are at their average levels, the odds of <code>diabtes</code> are 0.46.</p></li>
<li><p><code>glucose_centered</code>: Every 1-unit increase in glucose significantly increases the odds of <code>diabetes</code> by 4%.</p></li>
<li><p><code>bloodpressure</code>: Every 1-unit increase in blood pressure decreases the odds of <code>diabetes</code> by -0.16%. However, this is not statistically significant.</p></li>
</ul></section><section id="model-fit" class="level4" data-number="4.1.1.6"><h4 data-number="4.1.1.6" class="anchored" data-anchor-id="model-fit">
<span class="header-section-number">4.1.1.6</span> Model fit</h4>
<p>Suppose we want to compare whether adding <code>bmi</code> to a simpler model increases the fit of the model:</p>
<p>Simpler model</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">glucose</span> <span class="op">+</span> <span class="va">bloodpressure</span> <span class="op">+</span> <span class="va">insulin</span>, </span>
<span>             data <span class="op">=</span> <span class="va">data</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = outcome ~ glucose + bloodpressure + insulin, family = "binomial", 
    data = data)

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   -5.3381664  0.4943004 -10.799   &lt;2e-16 ***
glucose        0.0390197  0.0034669  11.255   &lt;2e-16 ***
bloodpressure -0.0013534  0.0044319  -0.305    0.760    
insulin       -0.0007271  0.0007565  -0.961    0.336    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 993.48  on 767  degrees of freedom
Residual deviance: 807.68  on 764  degrees of freedom
AIC: 815.68

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>Model with <code>bmi</code></p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">glucose</span> <span class="op">+</span> <span class="va">bloodpressure</span> <span class="op">+</span> <span class="va">insulin</span> <span class="op">+</span> <span class="va">bmi</span>, </span>
<span>             data <span class="op">=</span> <span class="va">data</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = outcome ~ glucose + bloodpressure + insulin + bmi, 
    family = "binomial", data = data)

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   -7.433886   0.657526 -11.306  &lt; 2e-16 ***
glucose        0.037708   0.003531  10.679  &lt; 2e-16 ***
bloodpressure -0.007430   0.004907  -1.514   0.1300    
insulin       -0.001493   0.000785  -1.902   0.0572 .  
bmi            0.083887   0.013880   6.044  1.5e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 993.48  on 767  degrees of freedom
Residual deviance: 765.48  on 763  degrees of freedom
AIC: 775.48

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>How do we choose the best model?</p>
<section id="aic" class="level5" data-number="4.1.1.6.1"><h5 data-number="4.1.1.6.1" class="anchored" data-anchor-id="aic">
<span class="header-section-number">4.1.1.6.1</span> AIC</h5>
<p>AIC (Akaike Information Criterion) is a metric used to compare and select the best model from a set of candidate models by balancing goodness-of-fit and complexity. It is calculated as follows:</p>
<p><span class="math display">\[
AIC = -2 * log(likelihood) + 2k
\]</span></p>
<p>In the AIC formula, <code>k</code> represents the number of parameters included in the model-including the intercept and all independent variables. The term <code>2k</code> serves as a penalty for model complexity. A lower AIC value indicates a model that achieves a better balance between fit and simplicity (parsimony). Therefore, among competing models, the one with the lowest AIC is generally preferred.</p>
<p><code>model1</code> had an AIC of 815.6764735 whereas <code>model2</code>` had an AIC of 775.4809783. Since <code>model2</code> has the lower AIC, it is the preferred model, as it achieves a better trade-off between model fit and complexity.</p>
</section><section id="pseudo-r2" class="level5" data-number="4.1.1.6.2"><h5 data-number="4.1.1.6.2" class="anchored" data-anchor-id="pseudo-r2">
<span class="header-section-number">4.1.1.6.2</span> Pseudo <code>R2</code>
</h5>
<p>Note that now <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> does not provide <code>R2</code> compared with <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>. This is because we need to use another fit estimate when using <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>. Even though everyone agrees on how to calculate <code>R2</code> and associated <em>p</em>-value for linear Models, there is no consensus on how to calculate <code>R2</code> for logistic regression. There are more than 10 different ways to do it!</p>
<p>One of the most common method is McFadden’s Pseudo <code>R2</code>. This method is very similar to the method in Linear Model. McFadden’s R squared measure is defined as:</p>
<p><span class="math display">\[
R^2_{McFadden} = \frac {1−log(Lc)} {log(Lnull)}
\]</span></p>
<p>where <code>Lc</code> denotes the (maximized) likelihood value from the current fitted model, and <code>Lnull</code> denotes the corresponding value but for the null model - the model with only an intercept and no covariates.</p>
<p>The log-likelihood <code>R2</code> values go from 0, for poor models, to 1, for good models and it can be calculated with the function <code><a href="https://rdrr.io/pkg/pscl/man/pR2.html">pscl::pR2()</a></code></p>
<p>The log-likelihood <code>R2</code> for <code>model</code> would be:</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/pscl/man/pR2.html">pR2</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fitting null model for pseudo-r2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>         llh      llhNull           G2     McFadden         r2ML         r2CU 
-403.8382368 -496.7419551  185.8074366    0.1870261    0.2148942    0.2961125 </code></pre>
</div>
</div>
<p>The log-likelihood <code>R2</code> for <code>model2</code> would be:</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/pscl/man/pR2.html">pR2</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fitting null model for pseudo-r2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>         llh      llhNull           G2     McFadden         r2ML         r2CU 
-382.7404891 -496.7419551  228.0029319    0.2294984    0.2568659    0.3539473 </code></pre>
</div>
</div>
<p>Because <code>model2</code> has a higher McFadden’s R<sup>2</sup> value, we conclude that <code>model2</code> fits the data better than <code>model1</code>.</p>
</section><section id="summary" class="level5" data-number="4.1.1.6.3"><h5 data-number="4.1.1.6.3" class="anchored" data-anchor-id="summary">
<span class="header-section-number">4.1.1.6.3</span> Summary</h5>
<p>Key insights:</p>
<ul>
<li><p>AIC looks for the best trade-off between fit and complexity.</p></li>
<li><p>Pseudo-R² only looks at improvement in fit (ignoring complexity)</p></li>
</ul>
<p>So, a model might:</p>
<ul>
<li><p>Have a higher pseudo-R²</p></li>
<li><p>But a higher (worse) AIC if it’s too complex</p></li>
</ul>
<p>For example:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 23%">
<col style="width: 17%">
<col style="width: 7%">
<col style="width: 32%">
</colgroup>
<thead><tr class="header">
<th>Model</th>
<th>Log-Likelihood</th>
<th>Parameters</th>
<th>AIC</th>
<th>McFadden’s pseudo R²</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Null Model</td>
<td>-150</td>
<td>1</td>
<td>302</td>
<td>0.00</td>
</tr>
<tr class="even">
<td>Model A</td>
<td>-100</td>
<td>3</td>
<td>206</td>
<td>0.33</td>
</tr>
<tr class="odd">
<td>Model B</td>
<td>-98</td>
<td>6</td>
<td>208</td>
<td>0.35</td>
</tr>
</tbody>
</table>
<p>Despite Model B having a slightly higher McFadden’s pseudo R<sup>2</sup> compared to model A, its AIC value is higher. Since AIC penalizes complexity and is more robust criterion for model selection, we prefer Model A over Model B due to its lower AIC.</p>
</section></section><section id="model-comparison" class="level4" data-number="4.1.1.7"><h4 data-number="4.1.1.7" class="anchored" data-anchor-id="model-comparison">
<span class="header-section-number">4.1.1.7</span> Model comparison</h4>
<p>To statistically compare models, we can use <code>anova(test = "Chisq")</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">model1</span>, <span class="va">model2</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  term                    df.residual residual.deviance    df deviance   p.value
  &lt;chr&gt;                         &lt;dbl&gt;             &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 outcome ~ glucose + bl…         764              808.    NA     NA   NA       
2 outcome ~ glucose + bl…         763              765.     1     42.2  8.26e-11</code></pre>
</div>
</div>
<p>Based on the Chi-square test from the likelihood ratio test, we conclude that <code>model2</code> fits the data significantly better than <code>model1</code> as the <em>p</em>-value is below 0.05.</p>
</section><section id="differences-between-aic-and-anovatest-chisq" class="level4" data-number="4.1.1.8"><h4 data-number="4.1.1.8" class="anchored" data-anchor-id="differences-between-aic-and-anovatest-chisq">
<span class="header-section-number">4.1.1.8</span> Differences between AIC and anova(test = “Chisq”)</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead><tr class="header">
<th>Feature</th>
<th>AIC</th>
<th>ANOVA (<code>test = "Chisq"</code>)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Purpose</strong></td>
<td>Model selection (fit vs.&nbsp;complexity)</td>
<td>Hypothesis testing (is extra predictor significant?)</td>
</tr>
<tr class="even">
<td><strong>Compares</strong></td>
<td>Any models (nested or not)</td>
<td>Only nested models (i.e., one is a subset of the other)</td>
</tr>
<tr class="odd">
<td><strong>Penalty for complexity</strong></td>
<td>Yes (via AIC formula)</td>
<td>No — tests if added complexity improves fit significantly</td>
</tr>
<tr class="even">
<td><strong>Based on</strong></td>
<td>Log-likelihood</td>
<td>Likelihood ratio test (LRT)</td>
</tr>
<tr class="odd">
<td><strong>Output</strong></td>
<td>AIC values</td>
<td>
<em>p</em>-values</td>
</tr>
</tbody>
</table></section></section><section id="poisson-regression" class="level3" data-number="4.1.2"><h3 data-number="4.1.2" class="anchored" data-anchor-id="poisson-regression">
<span class="header-section-number">4.1.2</span> Poisson regression</h3>
<p>In this section, we will briefly cover Poisson regression, a modelling technique used to analyze count data. To illustrate this, we will simulate a dataset where the outcome is the number of calls made by customers. We aim to predict <code>calls</code> using two predictors: <code>age</code> (age of customers) and <code>is_premium</code> (type of subscription: 1 = premium; 0 = regular customer).</p>
<p>Let’s simulate the dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Simulate a simple dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span>  <span class="co"># number of observations</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">20</span><span class="op">:</span><span class="fl">70</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  is_premium <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate expected call rate (log link)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.03</span> <span class="op">*</span> <span class="va">data</span><span class="op">$</span><span class="va">age</span> <span class="op">-</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="va">data</span><span class="op">$</span><span class="va">is_premium</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate call counts using Poisson distribution</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">calls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">n</span>, lambda <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the first few rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  age is_premium    lambda calls
1  50          1  4.055200     8
2  34          0  4.572225     6
3  70          0 13.463738    15
4  33          0  4.437096     4
5  22          1  1.750673     2
6  61          1  5.640654     6</code></pre>
</div>
</div>
<p>Now let’s fit the poisson regression model using <code>glm(family = poisson())</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">calls</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">is_premium</span>, data <span class="op">=</span> <span class="va">data</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = calls ~ age + is_premium, family = poisson(), data = data)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  0.43520    0.19898   2.187   0.0287 *  
age          0.02984    0.00352   8.476  &lt; 2e-16 ***
is_premium  -0.53497    0.09289  -5.759 8.44e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 248.63  on 99  degrees of freedom
Residual deviance: 107.94  on 97  degrees of freedom
AIC: 434.62

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>The coefficients are on the log scale of the rate and we use <code><a href="https://rdrr.io/r/base/Log.html">exp()</a></code> to exponentiate coefficients to get Incidence Rate Ratios (IRRs):</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         age  is_premium 
  1.5452686   1.0302855   0.5856854 </code></pre>
</div>
</div>
<p>Obtain 95% CI:</p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>               2.5 %    97.5 %
(Intercept) 1.040433 2.2700495
age         1.023243 1.0374640
is_premium  0.487611 0.7019417</code></pre>
</div>
</div>
<p>Interpretation</p>
<ul>
<li><p><code>age</code>: For every additional year of age, the expected number of calls increases by about 3%, holding subscription type constant. It is statistically significant.</p></li>
<li><p><code>is_premium</code>: Premium customers have about 41% fewer calls than regular customers, holding age constant (since 0.59 &lt; 1, it’s a decrease). It is statistically significant.</p></li>
</ul>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>